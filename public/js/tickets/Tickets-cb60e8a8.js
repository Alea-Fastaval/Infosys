import{t as se,u as ne,a as j,b as z,f as A}from"./users.service-e3a1e411.js";import{_ as ie,u as re,r as s,o as de,a as p,b as ue,c as C,d as P,e as a,f as o,w as r,F as pe,g as D,t as U,h as K,i as k,p as ce,j as ve}from"./index-00a8b370.js";const v={get:n=>localStorage.getItem(n),getBoolean:n=>localStorage.getItem(n)?localStorage.getItem(n)==="true":null,getNumber:n=>localStorage.getItem(n)?Number(localStorage.getItem(n)):null,set:(n,x)=>{localStorage.setItem(n,x)}};const d=n=>(ce("data-v-9b6eb2ce"),n=n(),ve(),n),me={style:{display:"inline-flex",gap:"1rem"}},ge={style:{display:"inline-flex",gap:"0.5rem"}},_e=d(()=>a("label",{for:"showOnlyOpen"},"Åbne opgaver",-1)),fe={style:{display:"inline-flex",gap:"0.5rem"}},be=d(()=>a("label",{for:"showOnlyMine"},"Mine opgaver",-1)),ye={class:"p-input-icon-left"},we=d(()=>a("i",{class:"pi pi-search"},null,-1)),he=d(()=>a("p",{style:{"text-align":"center"}},"Ingen opgaver fundet.",-1)),ke=d(()=>a("h4",null,"Opret opgave",-1)),xe={style:{display:"grid","grid-template-columns":"minmax(400px, 800px) minmax(150px, 300px)",gap:"1rem"}},Ve={style:{display:"flex","flex-direction":"column"}},Te=d(()=>a("label",{class:"help-text"},"Navn/Titel",-1)),Se=d(()=>a("label",{class:"help-text"},"Opgavebeskrivelse",-1)),Oe={style:{display:"flex","flex-direction":"column","background-color":"#eee",padding:"1rem",height:"min-content","padding-bottom":"1.5rem","border-radius":"4px"}},Ie=d(()=>a("label",{class:"help-text"},"Kategori",-1)),Ce=d(()=>a("label",{class:"help-text"},"Prioritet",-1)),Pe=d(()=>a("label",{class:"help-text"},"Udføres af",-1)),De={style:{display:"inline-flex",gap:"1rem"}},Ue={__name:"Tickets",setup(n){const x=re(),L=s(),N=s(),m=s(),M=s(),c=s(),g=s(!1),b=s(v.getBoolean("tickets_show_open_tickets")??!0),y=s(v.getBoolean("tickets_show_my_tickets")??!1),q=s(v.getNumber("tickets_page_per_rows")??10),V=s(""),_=s(""),f=s(""),T=s(0),S=s(0),w=s(""),R=async()=>{await j.fetchTickets().then(l=>{L.value=Object.values(l.tickets).map(e=>(e.category=c.value.tickets.category[e.category].da,e.creator=m.value.find(i=>i.id===e.creator).name,e.assignee=m.value.find(i=>i.id===e.assignee).name,e.status=e.open===1?c.value.tickets.status.open[e.status].da:c.value.tickets.status.closed[e.status].da,e)),h()})},h=()=>{var l;return N.value=(l=L.value)==null?void 0:l.filter(e=>H(e)&&E(e)&&G(e))},H=l=>l.name.toLowerCase().includes(V.value.toLowerCase())??!0,E=l=>b.value?l.open===1:!0,G=l=>y.value?l.assignee===M.value:!0,J=()=>{_.value="",f.value="",g.value=!0},Q=()=>{v.set("tickets_show_open_tickets",b.value),h()},W=()=>{v.set("tickets_show_my_tickets",y.value),h()},X=l=>{v.set("tickets_page_per_rows",l.rows)},Y=async()=>{await j.createTicket({name:_.value,description:f.value,priority:T.value,category:S.value,assignee:w.value}).then(async()=>{await R(),g.value=!1})},Z=()=>!_.value||!f.value||!w.value,ee=l=>{const e=l.data.id;x.push({path:`tickets/show/${e}`})};return de(async()=>{var l;c.value=await se.getTranslations(),m.value=Object.values(await ne.getUserList()),M.value=(l=m.value.find(e=>{var i;return e.id===((i=window==null?void 0:window.infosys)==null?void 0:i.user_id)}))==null?void 0:l.name,await R()}),(l,e)=>{const i=p("Button"),B=p("InputSwitch"),$=p("InputText"),te=p("Toolbar"),u=p("Column"),oe=p("DataTable"),ae=p("Textarea"),O=p("Dropdown"),le=p("Dialog"),F=ue("tooltip");return C(),P(pe,null,[a("div",null,[o(i,{icon:"pi pi-plus",size:"small",raised:"",onClick:e[0]||(e[0]=t=>J()),label:"Opret"})]),o(te,null,{start:r(()=>[a("div",me,[a("div",ge,[o(B,{inputId:"showOnlyOpen",modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=t=>b.value=t),onChange:e[2]||(e[2]=t=>Q())},null,8,["modelValue"]),_e]),a("div",fe,[o(B,{inputId:"showOnlyMine",modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=t=>y.value=t),onChange:e[4]||(e[4]=t=>W())},null,8,["modelValue"]),be])])]),end:r(()=>[a("span",ye,[we,o($,{class:"search-field",modelValue:V.value,"onUpdate:modelValue":e[5]||(e[5]=t=>V.value=t),modelModifiers:{trim:!0},onKeyup:e[6]||(e[6]=t=>h()),placeholder:"Søg i opgaver"},null,8,["modelValue"])])]),_:1}),o(oe,{onPage:e[7]||(e[7]=t=>X(t)),onRowClick:ee,value:N.value,rows:q.value,rowHover:!0,sortOrder:-1,rowsPerPageOptions:[5,10,20,50,100],size:"small","sort-field":"last_edit",paginatorTemplate:"FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink RowsPerPageDropdown",currentPageReportTemplate:"{first}-{last} ud af {totalRecords}",paginator:"",stripedRows:"",removableSort:""},{empty:r(()=>[he]),default:r(()=>[o(u,{field:"id",header:"ID",sortable:""}),o(u,{field:"category",header:"Kategori",sortable:""}),o(u,{field:"name",header:"Navn",sortable:""}),o(u,{field:"priority",header:"Prioritet",sortable:""},{body:r(t=>[D(U(c.value.tickets.priority[t.data.priority].da),1)]),_:1}),o(u,{field:"creator",header:"Opretter",sortable:""}),o(u,{field:"assignee",header:"Udfører",sortable:""}),o(u,{field:"status",header:"Status",sortable:""}),o(u,{field:"last_edit",header:"Ændret",sortable:""},{body:r(t=>[K((C(),P("div",null,[D(U(k(z)(t.data.last_edit)),1)])),[[F,k(A)(t.data.last_edit),void 0,{bottom:!0}]])]),_:1}),o(u,{field:"created",header:"Oprettet",sortable:""},{body:r(t=>[K((C(),P("div",null,[D(U(k(z)(t.data.created)),1)])),[[F,k(A)(t.data.created),void 0,{bottom:!0}]])]),_:1})]),_:1},8,["value","rows"]),o(le,{visible:g.value,"onUpdate:visible":e[15]||(e[15]=t=>g.value=t),modal:"",class:"newTicket"},{header:r(()=>[ke]),footer:r(()=>[a("div",De,[o(i,{severity:"info",text:"",label:"Luk",icon:"pi pi-times",onClick:e[13]||(e[13]=t=>g.value=!1)}),o(i,{label:"Opret opgave",raised:"",disabled:Z(),onClick:e[14]||(e[14]=t=>Y())},null,8,["disabled"])])]),default:r(()=>[a("div",xe,[a("div",Ve,[Te,o($,{modelValue:_.value,"onUpdate:modelValue":e[8]||(e[8]=t=>_.value=t),modelModifiers:{trim:!0},required:"",style:{width:"400px"}},null,8,["modelValue"]),Se,o(ae,{modelValue:f.value,"onUpdate:modelValue":e[9]||(e[9]=t=>f.value=t),modelModifiers:{trim:!0},autoResize:!0,rows:10,style:{width:"100%"},required:""},null,8,["modelValue"])]),a("div",Oe,[Ie,o(O,{modelValue:S.value,"onUpdate:modelValue":e[10]||(e[10]=t=>S.value=t),options:c.value.tickets.category.map((t,I)=>({label:t.da,value:I})),optionLabel:"label",optionValue:"value"},null,8,["modelValue","options"]),Ce,o(O,{modelValue:T.value,"onUpdate:modelValue":e[11]||(e[11]=t=>T.value=t),options:c.value.tickets.priority.map((t,I)=>({label:t.da,value:I})),optionLabel:"label",optionValue:"value"},null,8,["modelValue","options"]),Pe,o(O,{modelValue:w.value,"onUpdate:modelValue":e[12]||(e[12]=t=>w.value=t),options:m.value,resetFilterOnHide:!0,optionLabel:"name",optionValue:"id",filter:""},null,8,["modelValue","options"])])])]),_:1},8,["visible"])],64)}}},Me=ie(Ue,[["__scopeId","data-v-9b6eb2ce"]]);export{Me as default};
