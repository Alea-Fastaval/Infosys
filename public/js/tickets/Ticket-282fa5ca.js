import{t as ne,u as de,a as O,b as R,f as B}from"./users.service-e3a1e411.js";import{_ as ue,k as re,r as d,o as pe,l as ve,a as g,b as ce,c as f,d as N,f as o,w as u,m as F,n as G,F as me,g as y,t as r,q as X,e as a,h as w,i as _,p as ge,j as _e}from"./index-00a8b370.js";const n=S=>(ge("data-v-6faff949"),S=S(),_e(),S),ke={style:{display:"flex",float:"right",gap:"1rem"}},fe={style:{display:"flex"}},ye={style:{width:"100%","white-space":"pre-wrap"}},be={class:"ticket-details"},xe=n(()=>a("span",null,"Oprettet:",-1)),we=n(()=>a("span",null,"Ændret:",-1)),Te=n(()=>a("span",null,"Prioritet:",-1)),Ve=n(()=>a("span",null,"Oprettet af:",-1)),he=n(()=>a("span",null,"Udføres af:",-1)),Ue={class:"p-text-secondary"},Ce=n(()=>a("h4",null,"Rediger opgave",-1)),Ie={style:{display:"grid","grid-template-columns":"minmax(400px, 800px) minmax(150px, 300px)",gap:"1rem"}},Me={style:{display:"flex","flex-direction":"column"}},Se=n(()=>a("label",{class:"help-text"},"Navn/Titel",-1)),Le=n(()=>a("label",{class:"help-text"},"Opgavebeskrivelse",-1)),De={style:{display:"flex","flex-direction":"column","background-color":"#eee",padding:"1rem",height:"min-content","padding-bottom":"1.5rem","border-radius":"4px"}},$e=n(()=>a("label",{class:"help-text"},"Status",-1)),Oe=n(()=>a("label",{class:"help-text"},"Kategori",-1)),Re=n(()=>a("label",{class:"help-text"},"Prioritet",-1)),Be=n(()=>a("label",{class:"help-text"},"Udføres af",-1)),Ne={style:{display:"inline-flex",gap:"1rem"}},ze=n(()=>a("label",{class:"help-text"},"Besked",-1)),Fe={style:{display:"inline-flex",gap:"1rem"}},Ge={__name:"Ticket",setup(S){const q=re(),E=d(),l=d(),s=d(),T=d(),A=d(),V=d(!1),h=d(!1),P=d("new"),b=d(!1),U=d(),x=d(),v=d();let j=[{label:"Lukket",options:[{label:"Annulleret",open:0,status:0},{label:"Godkendt",open:0,status:1},{label:"Kan/vil ikke lave",open:0,status:2}]},{label:"Åben",options:[{label:"Oprettet",open:1,status:0},{label:"Startet",open:1,status:1},{label:"Skal testes",open:1,status:2},{label:"Venter",open:1,status:3}]}];const Y=()=>{var C,p,L,D,$,I,k,M,c,e;const i=(l==null?void 0:l.value.open)===1?(p=(C=v.value.tickets)==null?void 0:C.open)==null?void 0:p.da:(D=(L=v.value.tickets)==null?void 0:L.closed)==null?void 0:D.da,t=l.value.open===1?(k=(I=($=v.value.tickets)==null?void 0:$.status)==null?void 0:I.open[l.value.status])==null?void 0:k.da:(e=(c=(M=v.value.tickets)==null?void 0:M.status)==null?void 0:c.closed[l.value.status])==null?void 0:e.da;return{severity:l.value.open===1?"success":"secondary",value:`${i} - ${t}`}},Z=()=>({severity:"info",value:v.value.tickets.category[l.value.category].da}),ee=()=>{s.value={...s.value,open:U.value.open,status:U.value.status}},te=async()=>{b.value=!0,await O.updateTicket(s.value).then(async()=>{await H(),V.value=!1,b.value=!1})},ae=async()=>{b.value=!0,await O.updateTicketMessage(T.value).then(async()=>{await J(),h.value=!1,b.value=!1})},le=()=>{s.value={...l.value},V.value=!0,U.value=j[l.value.open].options[l.value.status]},K=i=>{T.value={...i,ticket:l.value.id},P.value=i?"edit":"new",h.value=!0},H=async()=>await O.getTicket(q.params.id).then(i=>l.value=i.tickets[q.params.id]),J=async()=>await O.fetchTicketMessages(l.value.id).then(i=>A.value=i.messages),se=()=>!s.value.name||!s.value.description||!s.value.assignee,oe=()=>!T.value,ie=i=>x.value.find(t=>t.id===i).name;return pe(async()=>{await ne.getTranslations().then(i=>v.value=i),x.value=Object.values(await de.getUserList()),await H(),await J()}),ve(()=>{var i;return E.value=(i=window==null?void 0:window.infosys)==null?void 0:i.user_id}),(i,t)=>{const Q=g("RouterLink"),C=g("Tag"),p=g("Button"),L=g("Card"),D=g("Timeline"),$=g("InputText"),I=g("Textarea"),k=g("Dropdown"),M=g("Dialog"),c=ce("tooltip");return f(),N(me,null,[o(Q,{to:"/",style:{"margin-bottom":"1rem",display:"inline-flex"}},{default:u(()=>[y("← Tilbage ")]),_:1}),x.value&&l.value?(f(),F(L,{key:0},{title:u(()=>{var e;return[y(r((e=l.value)==null?void 0:e.name)+" ",1),o(C,X(Y(),{rounded:""}),null,16),o(C,X(Z(),{rounded:""}),null,16),a("div",ke,[w(o(p,{icon:"pi pi-file-edit",onClick:t[0]||(t[0]=m=>le()),outlined:"",raised:"",rounded:"",severity:"secondary",size:"small"},null,512),[[c,"Rediger opgave",void 0,{top:!0}]]),w(o(p,{icon:"pi pi-comment",raised:"",rounded:"",size:"small",onClick:t[1]||(t[1]=m=>K())},null,512),[[c,"Ny besked",void 0,{top:!0}]])])]}),content:u(()=>{var e,m,W;return[a("div",fe,[a("div",ye,r(((e=l.value)==null?void 0:e.description)??"Ingen beskrivelse"),1),a("div",be,[xe,w((f(),N("span",null,[y(r(l.value.created?_(R)(l.value.created):"Ukendt"),1)])),[[c,_(B)(l.value.created),void 0,{bottom:!0}]]),we,w((f(),N("span",null,[y(r(l.value.last_edit?_(R)(l.value.last_edit):"-"),1)])),[[c,_(B)(l.value.last_edit),void 0,{bottom:!0}]]),Te,a("span",null,r(((W=(m=v.value)==null?void 0:m.tickets)==null?void 0:W.priority[l.value.priority].da)??"Ukendt"),1),Ve,a("span",null,r(x.value.find(z=>z.id===l.value.creator).name??"Ukendt"),1),he,a("span",null,r(x.value.find(z=>z.id===l.value.assignee).name??"Ukendt"),1)])])]}),_:1})):G("",!0),o(D,{value:A.value,style:{"padding-top":"1rem"}},{opposite:u(e=>[a("small",Ue,[y(r(ie(e.item.user))+" | ",1),w((f(),N("span",null,[y(r(e.item.last_edit?`${_(R)(e.item.last_edit)} (rettet)`:_(R)(e.item.posted)),1)])),[[c,e.item.last_edit?_(B)(e.item.last_edit):_(B)(e.item.posted),void 0,{top:!0}]])])]),marker:u(e=>[e.item.user===E.value?w((f(),F(p,{key:0,class:"timeline-btn",icon:"pi pi-file-edit",raised:"",rounded:"",size:"small",onClick:m=>K(e.item)},null,8,["onClick"])),[[c,"Rediger din besked",void 0,{top:!0}]]):G("",!0)]),content:u(e=>[y(r(e.item.message),1)]),_:1},8,["value"]),s.value?(f(),F(M,{key:1,visible:V.value,"onUpdate:visible":t[11]||(t[11]=e=>V.value=e),modal:""},{header:u(()=>[Ce]),footer:u(()=>[a("div",Ne,[o(p,{severity:"info",text:"",label:"Luk",icon:"pi pi-times",onClick:t[9]||(t[9]=e=>V.value=!1)}),o(p,{label:"Gem",raised:"",disabled:se(),onClick:t[10]||(t[10]=e=>te()),loading:b.value},null,8,["disabled","loading"])])]),default:u(()=>[a("div",Ie,[a("div",Me,[Se,o($,{modelValue:s.value.name,"onUpdate:modelValue":t[2]||(t[2]=e=>s.value.name=e),modelModifiers:{trim:!0},required:"",style:{width:"400px"}},null,8,["modelValue"]),Le,o(I,{modelValue:s.value.description,"onUpdate:modelValue":t[3]||(t[3]=e=>s.value.description=e),modelModifiers:{trim:!0},autoResize:!0,rows:10,style:{width:"100%"},required:""},null,8,["modelValue"])]),a("div",De,[$e,o(k,{class:"status-select",modelValue:U.value,"onUpdate:modelValue":t[4]||(t[4]=e=>U.value=e),options:_(j),optionLabel:"label",optionGroupLabel:"label",optionGroupChildren:"options",onChange:t[5]||(t[5]=e=>ee())},null,8,["modelValue","options"]),Oe,o(k,{modelValue:s.value.category,"onUpdate:modelValue":t[6]||(t[6]=e=>s.value.category=e),options:v.value.tickets.category.map((e,m)=>({label:e.da,value:m})),optionLabel:"label",optionValue:"value"},null,8,["modelValue","options"]),Re,o(k,{modelValue:s.value.priority,"onUpdate:modelValue":t[7]||(t[7]=e=>s.value.priority=e),options:v.value.tickets.priority.map((e,m)=>({label:e.da,value:m})),optionLabel:"label",optionValue:"value"},null,8,["modelValue","options"]),Be,o(k,{modelValue:s.value.assignee,"onUpdate:modelValue":t[8]||(t[8]=e=>s.value.assignee=e),options:x.value,resetFilterOnHide:!0,optionLabel:"name",optionValue:"id",filter:""},null,8,["modelValue","options"])])])]),_:1},8,["visible"])):G("",!0),o(M,{visible:h.value,"onUpdate:visible":t[14]||(t[14]=e=>h.value=e),modal:"",style:{width:"100%","max-width":"750px",margin:"0 10px"}},{header:u(()=>[a("h4",null,r(P.value==="new"?"Ny besked":"Rediger besked"),1)]),footer:u(()=>[a("div",Fe,[o(p,{severity:"info",text:"",label:"Luk",icon:"pi pi-times",onClick:t[13]||(t[13]=e=>h.value=!1)}),o(p,{label:"Gem",raised:"",disabled:oe(),onClick:ae,loading:b.value},null,8,["disabled","loading"])])]),default:u(()=>[ze,o(I,{modelValue:T.value.message,"onUpdate:modelValue":t[12]||(t[12]=e=>T.value.message=e),modelModifiers:{trim:!0},autoResize:!0,rows:10,style:{width:"100%"},required:""},null,8,["modelValue"])]),_:1},8,["visible"])],64)}}},Ae=ue(Ge,[["__scopeId","data-v-6faff949"]]);export{Ae as default};
